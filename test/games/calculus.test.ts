/* eslint-disable no-unused-expressions */
/* eslint-disable @typescript-eslint/no-unused-expressions */
/* tslint:disable:no-unused-expression */

import "mocha";
import { expect } from "chai";
import { CalculusGame } from '../../src/games';

describe("Calculus", () => {
    it("Pathfinding", () => {
        // fully encircled
        let state = `{"game":"calculus","numplayers":2,"variants":[],"gameover":false,"winner":[],"stack":[{"_version":"20240518","_results":[],"_timestamp":"2024-07-17T16:01:11.038Z","currplayer":1,"pieces":[],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"122.95,88.36"}],"_timestamp":"2024-07-17T16:01:12.705Z","currplayer":2,"lastmove":"122.95,88.36","pieces":[{"r":10,"steps":64,"cx":122.95,"cy":88.36,"owner":1}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"146.13,104.63"}],"_timestamp":"2024-07-17T16:01:13.494Z","currplayer":1,"lastmove":"146.13,104.63","pieces":[{"r":10,"steps":64,"cx":122.95,"cy":88.36,"owner":1},{"r":10,"steps":64,"cx":146.13,"cy":104.63,"owner":2}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"154.27,130.26"}],"_timestamp":"2024-07-17T16:01:14.323Z","currplayer":2,"lastmove":"154.27,130.26","pieces":[{"r":10,"steps":64,"cx":122.95,"cy":88.36,"owner":1},{"r":10,"steps":64,"cx":146.13,"cy":104.63,"owner":2},{"r":10,"steps":64,"cx":154.27,"cy":130.26,"owner":1}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"136.37,147.75"}],"_timestamp":"2024-07-17T16:01:15.177Z","currplayer":1,"lastmove":"136.37,147.75","pieces":[{"r":10,"steps":64,"cx":122.95,"cy":88.36,"owner":1},{"r":10,"steps":64,"cx":146.13,"cy":104.63,"owner":2},{"r":10,"steps":64,"cx":154.27,"cy":130.26,"owner":1},{"r":10,"steps":64,"cx":136.37,"cy":147.75,"owner":2}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"106.27,154.26"}],"_timestamp":"2024-07-17T16:01:16.028Z","currplayer":2,"lastmove":"106.27,154.26","pieces":[{"r":10,"steps":64,"cx":122.95,"cy":88.36,"owner":1},{"r":10,"steps":64,"cx":146.13,"cy":104.63,"owner":2},{"r":10,"steps":64,"cx":154.27,"cy":130.26,"owner":1},{"r":10,"steps":64,"cx":136.37,"cy":147.75,"owner":2},{"r":10,"steps":64,"cx":106.27,"cy":154.26,"owner":1}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"89.99,139.62"}],"_timestamp":"2024-07-17T16:01:16.943Z","currplayer":1,"lastmove":"89.99,139.62","pieces":[{"r":10,"steps":64,"cx":122.95,"cy":88.36,"owner":1},{"r":10,"steps":64,"cx":146.13,"cy":104.63,"owner":2},{"r":10,"steps":64,"cx":154.27,"cy":130.26,"owner":1},{"r":10,"steps":64,"cx":136.37,"cy":147.75,"owner":2},{"r":10,"steps":64,"cx":106.27,"cy":154.26,"owner":1},{"r":10,"steps":64,"cx":89.99,"cy":139.62,"owner":2}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"76.16,115.61"}],"_timestamp":"2024-07-17T16:01:17.821Z","currplayer":2,"lastmove":"76.16,115.61","pieces":[{"r":10,"steps":64,"cx":122.95,"cy":88.36,"owner":1},{"r":10,"steps":64,"cx":146.13,"cy":104.63,"owner":2},{"r":10,"steps":64,"cx":154.27,"cy":130.26,"owner":1},{"r":10,"steps":64,"cx":136.37,"cy":147.75,"owner":2},{"r":10,"steps":64,"cx":106.27,"cy":154.26,"owner":1},{"r":10,"steps":64,"cx":89.99,"cy":139.62,"owner":2},{"r":10,"steps":64,"cx":76.16,"cy":115.61,"owner":1}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"92.44,93.65"}],"_timestamp":"2024-07-17T16:01:18.635Z","currplayer":1,"lastmove":"92.44,93.65","pieces":[{"r":10,"steps":64,"cx":122.95,"cy":88.36,"owner":1},{"r":10,"steps":64,"cx":146.13,"cy":104.63,"owner":2},{"r":10,"steps":64,"cx":154.27,"cy":130.26,"owner":1},{"r":10,"steps":64,"cx":136.37,"cy":147.75,"owner":2},{"r":10,"steps":64,"cx":106.27,"cy":154.26,"owner":1},{"r":10,"steps":64,"cx":89.99,"cy":139.62,"owner":2},{"r":10,"steps":64,"cx":76.16,"cy":115.61,"owner":1},{"r":10,"steps":64,"cx":92.44,"cy":93.65,"owner":2}],"connPath":[]}]}`;
        let game = new CalculusGame(state);
        let result = game.validateMove("118,120");
        expect(result.valid).to.be.false;

        // one null direction, distance too short, but on "other" side of line
        state = `{"game":"calculus","numplayers":2,"variants":[],"gameover":false,"winner":[],"stack":[{"_version":"20240518","_results":[],"_timestamp":"2024-07-15T12:39:29.062Z","currplayer":1,"pieces":[],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"124.11,79.69"}],"_timestamp":"2024-07-15T13:48:42.696Z","currplayer":2,"lastmove":"124.11,79.69","pieces":[{"r":10,"steps":64,"cx":124.11,"cy":79.69,"owner":1}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"127.58,131.91"}],"_timestamp":"2024-07-15T16:08:34.239Z","currplayer":1,"lastmove":"127.58,131.91","pieces":[{"r":10,"steps":64,"cx":124.11,"cy":79.69,"owner":1},{"r":10,"steps":64,"cx":127.58,"cy":131.91,"owner":2}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"140.54,147.14"}],"_timestamp":"2024-07-15T23:47:04.004Z","currplayer":2,"lastmove":"140.54,147.14","pieces":[{"r":10,"steps":64,"cx":124.11,"cy":79.69,"owner":1},{"r":10,"steps":64,"cx":127.58,"cy":131.91,"owner":2},{"r":10,"steps":64,"cx":140.54,"cy":147.14,"owner":1}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"119.3,177.74"}],"_timestamp":"2024-07-16T00:44:45.753Z","currplayer":1,"lastmove":"119.3,177.74","pieces":[{"r":10,"steps":64,"cx":124.11,"cy":79.69,"owner":1},{"r":10,"steps":64,"cx":127.58,"cy":131.91,"owner":2},{"r":10,"steps":64,"cx":140.54,"cy":147.14,"owner":1},{"r":10,"steps":64,"cx":119.3,"cy":177.74,"owner":2}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"111.92,150.84"}],"_timestamp":"2024-07-16T02:29:17.155Z","currplayer":2,"lastmove":"111.92,150.84","pieces":[{"r":10,"steps":64,"cx":124.11,"cy":79.69,"owner":1},{"r":10,"steps":64,"cx":127.58,"cy":131.91,"owner":2},{"r":10,"steps":64,"cx":140.54,"cy":147.14,"owner":1},{"r":10,"steps":64,"cx":119.3,"cy":177.74,"owner":2},{"r":10,"steps":64,"cx":111.92,"cy":150.84,"owner":1}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"50.1,158.62"}],"_timestamp":"2024-07-16T02:58:29.610Z","currplayer":1,"lastmove":"50.1,158.62","pieces":[{"r":10,"steps":64,"cx":124.11,"cy":79.69,"owner":1},{"r":10,"steps":64,"cx":127.58,"cy":131.91,"owner":2},{"r":10,"steps":64,"cx":140.54,"cy":147.14,"owner":1},{"r":10,"steps":64,"cx":119.3,"cy":177.74,"owner":2},{"r":10,"steps":64,"cx":111.92,"cy":150.84,"owner":1},{"r":10,"steps":64,"cx":50.1,"cy":158.62,"owner":2}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"69.78,155.03"}],"_timestamp":"2024-07-16T08:56:39.309Z","currplayer":2,"lastmove":"69.78,155.03","pieces":[{"r":10,"steps":64,"cx":124.11,"cy":79.69,"owner":1},{"r":10,"steps":64,"cx":127.58,"cy":131.91,"owner":2},{"r":10,"steps":64,"cx":140.54,"cy":147.14,"owner":1},{"r":10,"steps":64,"cx":119.3,"cy":177.74,"owner":2},{"r":10,"steps":64,"cx":111.92,"cy":150.84,"owner":1},{"r":10,"steps":64,"cx":50.1,"cy":158.62,"owner":2},{"r":10,"steps":64,"cx":69.78,"cy":155.03,"owner":1}],"connPath":[]},{"_version":"20240518","_results":[{"type":"place","where":"89.69,153.11"}],"_timestamp":"2024-07-16T11:43:39.873Z","currplayer":1,"lastmove":"89.69,153.11","pieces":[{"r":10,"steps":64,"cx":124.11,"cy":79.69,"owner":1},{"r":10,"steps":64,"cx":127.58,"cy":131.91,"owner":2},{"r":10,"steps":64,"cx":140.54,"cy":147.14,"owner":1},{"r":10,"steps":64,"cx":119.3,"cy":177.74,"owner":2},{"r":10,"steps":64,"cx":111.92,"cy":150.84,"owner":1},{"r":10,"steps":64,"cx":50.1,"cy":158.62,"owner":2},{"r":10,"steps":64,"cx":69.78,"cy":155.03,"owner":1},{"r":10,"steps":64,"cx":89.69,"cy":153.11,"owner":2}],"connPath":[]}]}`;
        game = new CalculusGame(state);
        result = game.validateMove("95.37,172.29");
        expect(result.valid).to.be.true;
    });
});

