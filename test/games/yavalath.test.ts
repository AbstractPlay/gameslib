/* eslint-disable no-unused-expressions */
/* eslint-disable @typescript-eslint/no-unused-expressions */

import "mocha";
import { expect } from "chai";
import { YavalathGame } from '../../src/games';

const bugState = `{"game":"yavalath","numplayers":3,"variants":[],"gameover":false,"winner":[],"stack":[{"_version":"20250112","_results":[],"_timestamp":"2025-01-23T17:17:29.832Z","currplayer":1,"board":{"dataType":"Map","value":[]}},{"_version":"20250112","_results":[{"type":"place","where":"e5"}],"_timestamp":"2025-01-23T22:12:49.748Z","currplayer":2,"lastmove":"e5","board":{"dataType":"Map","value":[["e5",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"f6"}],"_timestamp":"2025-01-24T14:55:55.687Z","currplayer":3,"lastmove":"f6","board":{"dataType":"Map","value":[["e5",1],["f6",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"c4"}],"_timestamp":"2025-01-24T17:48:30.490Z","currplayer":1,"lastmove":"c4","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"f4"}],"_timestamp":"2025-01-24T20:33:02.712Z","currplayer":2,"lastmove":"f4","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"d6"}],"_timestamp":"2025-01-24T20:34:45.056Z","currplayer":3,"lastmove":"d6","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"c5"}],"_timestamp":"2025-01-24T21:01:49.498Z","currplayer":1,"lastmove":"c5","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"h2"}],"_timestamp":"2025-01-24T22:47:35.703Z","currplayer":2,"lastmove":"h2","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"f5"}],"_timestamp":"2025-01-24T23:56:19.127Z","currplayer":3,"lastmove":"f5","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"g3"}],"_timestamp":"2025-01-25T21:20:11.852Z","currplayer":1,"lastmove":"g3","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"e7"}],"_timestamp":"2025-01-25T21:32:20.413Z","currplayer":2,"lastmove":"e7","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"d4"}],"_timestamp":"2025-01-25T23:53:32.966Z","currplayer":3,"lastmove":"d4","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"c7"}],"_timestamp":"2025-01-26T02:23:55.002Z","currplayer":1,"lastmove":"c7","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"c6"}],"_timestamp":"2025-01-26T13:02:39.795Z","currplayer":2,"lastmove":"c6","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"e3"}],"_timestamp":"2025-01-26T13:04:18.011Z","currplayer":3,"lastmove":"e3","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"g4"}],"_timestamp":"2025-01-27T00:46:21.529Z","currplayer":1,"lastmove":"g4","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"d3"}],"_timestamp":"2025-01-27T01:13:36.054Z","currplayer":2,"lastmove":"d3","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3],["d3",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"c2"}],"_timestamp":"2025-01-30T22:41:14.068Z","currplayer":3,"lastmove":"c2","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3],["d3",1],["c2",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"g6"}],"_timestamp":"2025-01-31T17:31:30.541Z","currplayer":1,"lastmove":"g6","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3],["d3",1],["c2",2],["g6",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"g5"}],"_timestamp":"2025-01-31T19:32:46.615Z","currplayer":2,"lastmove":"g5","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3],["d3",1],["c2",2],["g6",3],["g5",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"g2"}],"_timestamp":"2025-01-31T22:11:41.609Z","currplayer":3,"lastmove":"g2","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3],["d3",1],["c2",2],["g6",3],["g5",1],["g2",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"b2"}],"_timestamp":"2025-02-01T17:14:13.482Z","currplayer":1,"lastmove":"b2","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3],["d3",1],["c2",2],["g6",3],["g5",1],["g2",2],["b2",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"d7"}],"_timestamp":"2025-02-01T18:10:50.429Z","currplayer":2,"lastmove":"d7","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3],["d3",1],["c2",2],["g6",3],["g5",1],["g2",2],["b2",3],["d7",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"c1"}],"_timestamp":"2025-02-03T10:24:32.329Z","currplayer":3,"lastmove":"c1","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3],["d3",1],["c2",2],["g6",3],["g5",1],["g2",2],["b2",3],["d7",1],["c1",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"e8"}],"_timestamp":"2025-02-03T17:14:14.572Z","currplayer":1,"lastmove":"e8","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3],["d3",1],["c2",2],["g6",3],["g5",1],["g2",2],["b2",3],["d7",1],["c1",2],["e8",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"a4"}],"_timestamp":"2025-02-03T23:19:20.379Z","currplayer":2,"lastmove":"a4","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3],["d3",1],["c2",2],["g6",3],["g5",1],["g2",2],["b2",3],["d7",1],["c1",2],["e8",3],["a4",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"f3"}],"_timestamp":"2025-02-05T01:02:40.408Z","currplayer":3,"lastmove":"f3","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3],["d3",1],["c2",2],["g6",3],["g5",1],["g2",2],["b2",3],["d7",1],["c1",2],["e8",3],["a4",1],["f3",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"b5"}],"_timestamp":"2025-02-05T01:42:27.036Z","currplayer":1,"lastmove":"b5","board":{"dataType":"Map","value":[["e5",1],["f6",2],["c4",3],["f4",1],["d6",2],["c5",3],["h2",1],["f5",2],["g3",3],["e7",1],["d4",2],["c7",3],["c6",1],["e3",2],["g4",3],["d3",1],["c2",2],["g6",3],["g5",1],["g2",2],["b2",3],["d7",1],["c1",2],["e8",3],["a4",1],["f3",2],["b5",3]]}}]}`;

const bugstate2 = `{"game":"yavalath","numplayers":3,"variants":[],"gameover":false,"winner":[],"stack":[{"_version":"20250112","_results":[],"_timestamp":"2025-01-23T17:17:20.535Z","currplayer":1,"board":{"dataType":"Map","value":[]}},{"_version":"20250112","_results":[{"type":"place","where":"e4"}],"_timestamp":"2025-01-23T17:17:34.490Z","currplayer":2,"lastmove":"e4","board":{"dataType":"Map","value":[["e4",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"e5"}],"_timestamp":"2025-01-23T17:18:07.308Z","currplayer":3,"lastmove":"e5","board":{"dataType":"Map","value":[["e4",1],["e5",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"f4"}],"_timestamp":"2025-01-25T05:43:04.058Z","currplayer":1,"lastmove":"f4","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"e1"}],"_timestamp":"2025-01-25T21:19:27.934Z","currplayer":2,"lastmove":"e1","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"c4"}],"_timestamp":"2025-01-25T23:21:48.384Z","currplayer":3,"lastmove":"c4","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"d5"}],"_timestamp":"2025-01-26T07:49:35.401Z","currplayer":1,"lastmove":"d5","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"e3"}],"_timestamp":"2025-01-27T00:44:51.671Z","currplayer":2,"lastmove":"e3","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"d4"}],"_timestamp":"2025-01-30T10:28:36.989Z","currplayer":3,"lastmove":"d4","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"e2"}],"_timestamp":"2025-01-30T17:44:15.475Z","currplayer":1,"lastmove":"e2","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"b2"}],"_timestamp":"2025-01-30T18:28:36.197Z","currplayer":2,"lastmove":"b2","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"c2"}],"_timestamp":"2025-01-31T22:08:29.993Z","currplayer":3,"lastmove":"c2","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"f2"}],"_timestamp":"2025-02-01T06:25:23.124Z","currplayer":1,"lastmove":"f2","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"g5"}],"_timestamp":"2025-02-01T17:12:30.882Z","currplayer":2,"lastmove":"g5","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"e7"}],"_timestamp":"2025-02-02T22:21:06.020Z","currplayer":3,"lastmove":"e7","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"h2"}],"_timestamp":"2025-02-03T15:13:11.191Z","currplayer":1,"lastmove":"h2","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"b3"}],"_timestamp":"2025-02-03T17:16:21.614Z","currplayer":2,"lastmove":"b3","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"g2"}],"_timestamp":"2025-02-04T18:22:53.619Z","currplayer":3,"lastmove":"g2","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"f5"}],"_timestamp":"2025-02-05T15:34:45.825Z","currplayer":1,"lastmove":"f5","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"d3"}],"_timestamp":"2025-02-05T15:49:09.076Z","currplayer":2,"lastmove":"d3","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"f3"}],"_timestamp":"2025-02-05T17:22:15.584Z","currplayer":3,"lastmove":"f3","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"c3"}],"_timestamp":"2025-02-06T17:18:42.234Z","currplayer":1,"lastmove":"c3","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"b5"}],"_timestamp":"2025-02-06T17:28:05.765Z","currplayer":2,"lastmove":"b5","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"e8"}],"_timestamp":"2025-02-07T17:35:50.096Z","currplayer":3,"lastmove":"e8","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"b4"}],"_timestamp":"2025-02-08T06:38:11.900Z","currplayer":1,"lastmove":"b4","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"e6"}],"_timestamp":"2025-02-08T16:23:11.566Z","currplayer":2,"lastmove":"e6","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"g3"}],"_timestamp":"2025-02-08T21:46:14.273Z","currplayer":3,"lastmove":"g3","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"h3"}],"_timestamp":"2025-02-09T07:17:20.296Z","currplayer":1,"lastmove":"h3","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"g1"}],"_timestamp":"2025-02-10T14:39:52.356Z","currplayer":2,"lastmove":"g1","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"g6"}],"_timestamp":"2025-02-10T21:30:23.015Z","currplayer":3,"lastmove":"g6","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"h5"}],"_timestamp":"2025-02-11T17:08:48.057Z","currplayer":1,"lastmove":"h5","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"h1"}],"_timestamp":"2025-02-11T17:16:31.553Z","currplayer":2,"lastmove":"h1","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"h4"}],"_timestamp":"2025-02-11T18:35:44.065Z","currplayer":3,"lastmove":"h4","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"f1"}],"_timestamp":"2025-02-12T13:28:16.929Z","currplayer":1,"lastmove":"f1","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"b6"}],"_timestamp":"2025-02-12T14:31:20.113Z","currplayer":2,"lastmove":"b6","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"c5"}],"_timestamp":"2025-02-12T23:35:08.896Z","currplayer":3,"lastmove":"c5","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1],["c5",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"d6"}],"_timestamp":"2025-02-13T17:14:16.950Z","currplayer":1,"lastmove":"d6","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1],["c5",2],["d6",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"f6"}],"_timestamp":"2025-02-13T17:44:10.534Z","currplayer":2,"lastmove":"f6","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1],["c5",2],["d6",3],["f6",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"c7"}],"_timestamp":"2025-02-14T01:07:22.230Z","currplayer":3,"lastmove":"c7","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1],["c5",2],["d6",3],["f6",1],["c7",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"c6"}],"_timestamp":"2025-02-14T15:56:58.615Z","currplayer":1,"lastmove":"c6","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1],["c5",2],["d6",3],["f6",1],["c7",2],["c6",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"d8"}],"_timestamp":"2025-02-14T17:36:55.884Z","currplayer":2,"lastmove":"d8","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1],["c5",2],["d6",3],["f6",1],["c7",2],["c6",3],["d8",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"f8"}],"_timestamp":"2025-02-14T17:48:41.379Z","currplayer":3,"lastmove":"f8","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1],["c5",2],["d6",3],["f6",1],["c7",2],["c6",3],["d8",1],["f8",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"g7"}],"_timestamp":"2025-02-15T06:20:54.917Z","currplayer":1,"lastmove":"g7","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1],["c5",2],["d6",3],["f6",1],["c7",2],["c6",3],["d8",1],["f8",2],["g7",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"i4"}],"_timestamp":"2025-02-15T21:14:13.192Z","currplayer":2,"lastmove":"i4","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1],["c5",2],["d6",3],["f6",1],["c7",2],["c6",3],["d8",1],["f8",2],["g7",3],["i4",1]]}},{"_version":"20250112","_results":[{"type":"place","where":"i3"}],"_timestamp":"2025-02-16T12:12:50.370Z","currplayer":3,"lastmove":"i3","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1],["c5",2],["d6",3],["f6",1],["c7",2],["c6",3],["d8",1],["f8",2],["g7",3],["i4",1],["i3",2]]}},{"_version":"20250112","_results":[{"type":"place","where":"i2"}],"_timestamp":"2025-02-17T16:37:59.318Z","currplayer":1,"lastmove":"i2","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1],["c5",2],["d6",3],["f6",1],["c7",2],["c6",3],["d8",1],["f8",2],["g7",3],["i4",1],["i3",2],["i2",3]]}},{"_version":"20250112","_results":[{"type":"place","where":"i5"}],"_timestamp":"2025-02-17T19:16:21.462Z","currplayer":2,"lastmove":"i5","board":{"dataType":"Map","value":[["e4",1],["e5",2],["f4",3],["e1",1],["c4",2],["d5",3],["e3",1],["d4",2],["e2",3],["b2",1],["c2",2],["f2",3],["g5",1],["e7",2],["h2",3],["b3",1],["g2",2],["f5",3],["d3",1],["f3",2],["c3",3],["b5",1],["e8",2],["b4",3],["e6",1],["g3",2],["h3",3],["g1",1],["g6",2],["h5",3],["h1",1],["h4",2],["f1",3],["b6",1],["c5",2],["d6",3],["f6",1],["c7",2],["c6",3],["d8",1],["f8",2],["g7",3],["i4",1],["i3",2],["i2",3],["i5",1]]}}]}`;

describe("Yavalath", () => {
    it ("Three loses", () => {
        let g = new YavalathGame(2);
        g.board.set("e1", 1);
        g.board.set("e2", 1);
        g.move("e3");
        expect(g.gameover).to.be.true;
        expect(g.winner).to.have.members([2]);

        g = new YavalathGame(2);
        g.board.set("i1", 1);
        g.board.set("h2", 1);
        g.move("g3");
        expect(g.gameover).to.be.true;
        expect(g.winner).to.have.members([2]);

        g = new YavalathGame(2);
        g.board.set("i1", 1);
        g.board.set("h1", 1);
        g.move("g1");
        expect(g.gameover).to.be.true;
        expect(g.winner).to.have.members([2]);
    });
    it ("Four wins", () => {
        let g = new YavalathGame(2);
        g.board.set("e1", 1);
        g.board.set("e2", 1);
        g.board.set("e4", 1);
        g.move("e3");
        expect(g.gameover).to.be.true;
        expect(g.winner).to.have.members([1]);

        g = new YavalathGame(2);
        g.board.set("i1", 1);
        g.board.set("h2", 1);
        g.board.set("f4", 1);
        g.move("g3");
        expect(g.gameover).to.be.true;
        expect(g.winner).to.have.members([1]);

        g = new YavalathGame(2);
        g.board.set("i1", 1);
        g.board.set("h1", 1);
        g.board.set("f1", 1);
        g.move("g1");
        expect(g.gameover).to.be.true;
        expect(g.winner).to.have.members([1]);
    });
    it ("3P must block", () => {
        let g = new YavalathGame(3);
        g.board.set("e1", 2);
        g.board.set("e2", 2);
        g.board.set("e4", 2);
        let bad = g.validateMove("a1");
        expect(bad.valid).to.be.false;
        let good = g.validateMove("e3");
        expect(good.valid).to.be.true;
        expect(good.complete).to.equal(1);

        // from bug report
        g = new YavalathGame(bugState);
        bad = g.validateMove("e1");
        expect(bad.valid).to.be.false;
        good = g.validateMove("e4");
        expect(good.valid).to.be.true;
        expect(good.complete).to.equal(1);
        good = g.validateMove("d2")
        expect(good.valid).to.be.true;
        expect(good.complete).to.equal(1);
    });
    it ("Currplayer correctly set after elimination", () => {
        const g = new YavalathGame(bugstate2);
        expect(g.eliminated).to.be.undefined;
        g.move("g4");
        expect(g.eliminated).equal(2);
        g.move("c1");
        g.move("e9");
        expect(g.eliminated).equal(2);
        expect(g.currplayer).equal(3);
    });
});

